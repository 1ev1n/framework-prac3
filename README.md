# Распределенный монолит ISS NASA

Цель проекта — собрать три модуля в единой докер среде и отдать студентам рабочий легаси с намеренно плохими решениями, чтобы они исправляли и переписывали

Что включено
- Модуль один — Rust сервис, каждые десять минут тянет JSON с конфигурируемого URL, сохраняет сырой ответ в Postgres и отдает REST
- Модуль два — Laravel сайт на PHP с Bootstrap, подключается к БД и к REST, на дашборде таблицы, графики, формы и медиа, в код намеренно добавлены проблемы безопасности и качества
- Модуль три — Pascal программа, генерирует CSV телеметрию и заливает ее в Postgres через psql COPY

Минимальные требования
- Ubuntu 24.04
- Docker и Docker Compose V2
- Интернет доступ при сборке контейнеров

Быстрый запуск
1. Скачай архив и распакуй в каталог проекта
2. Скопируй .env.example в .env при необходимости поправь значения
3. Запусти docker compose up --build -d
4. Проверь веб страницу по адресу http://localhost:8080
5. Проверь REST Rust сервис по адресу http://localhost:8081/health и /last

Полезные детали
- Rust сервис использует переменную NASA_API_URL для первичного запроса, если переменная пустая или запрос неудачен используется WHERE_ISS_URL по умолчанию из wheretheiss
- Laravel поднимается в общий том и при первом старте сам создается через composer create-project затем поверх накладываются патчи из папки laravel-patches
- Pascal контейнер каждые пять минут пишет новый CSV и тут же выполняет COPY в таблицу telemetry_legacy

В таблицу telemetry_legacy пишется простой набор полей для демонстрации и тренировки
- recorded_at
- voltage
- temp
- source_file

Список заведомо плохих практик в Laravel для учебной отладки
- Включен debug режим
- В коде есть сырые SQL запросы и конкатенация с параметрами запроса из URL
- На некоторых шаблонах вывод без экранирования что дает шанс XSS
- Проверка CSRF для части маршрутов отключена
- Недостаточная валидация для загрузки файлов
- Наличие слабого APP_KEY в .env внутри контейнера

Замечание по NASA
- По умолчанию используется источник wheretheiss для стабильности демо, при наличии ключа можно указать NASA_API_URL, например один из публичных API NASA

Остановка и очистка
1. docker compose down
2. docker volume rm $(docker volume ls -q | grep distributed-monolith-iss_appdata) при необходимости
3. docker volume rm $(docker volume ls -q | grep distributed-monolith-iss_pgdata) при необходимости
